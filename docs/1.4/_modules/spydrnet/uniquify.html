

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>spydrnet.uniquify &mdash; SpyDrNet 1.4.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> SpyDrNet
          

          
          </a>

          
            
            
              <div class="version">
                1.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">Developerâ€™s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../credits.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../auto_examples/index.html">Examples</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SpyDrNet</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>spydrnet.uniquify</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for spydrnet.uniquify</h1><div class="highlight"><pre>
<span></span><span class="c1">#Copyright 2020 Dallin Skouson, Andrew Keller, Michael Wirthlin</span>

<span class="kn">from</span> <span class="nn">spydrnet.ir</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">deque</span>

<span class="sd">&#39;&#39;&#39;code to make definitions unique throughout a netlist. </span>
<span class="sd">expected parameters,</span>
<span class="sd">uniqify -- makes all definitions unique below the top instance. definitions that are not referenced below the top instance will not be unique.</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="n">mod_name_uid</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">def</span> <span class="nf">_get_unique_name_modifier</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">mod_name_uid</span>
    <span class="n">str_out</span> <span class="o">=</span> <span class="s2">&quot;_sdn_unique_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mod_name_uid</span><span class="p">)</span>
    <span class="n">mod_name_uid</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">str_out</span>

<span class="k">def</span> <span class="nf">_make_instance_unique</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;clone the definition and point the reference to the new definition&#39;&#39;&#39;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">reference</span>
    <span class="n">lib</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">reference</span><span class="o">.</span><span class="n">library</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">definitions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span>
    <span class="n">new_def</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">reference</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">instance</span><span class="o">.</span><span class="n">reference</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">reference</span><span class="o">.</span><span class="n">name</span>
        <span class="n">unique_suffix</span> <span class="o">=</span> <span class="n">_get_unique_name_modifier</span><span class="p">()</span>
        <span class="n">new_def</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="n">unique_suffix</span>
        <span class="k">if</span> <span class="s1">&#39;EDIF.identifier&#39;</span> <span class="ow">in</span> <span class="n">new_def</span><span class="p">:</span>
            <span class="n">new_def</span><span class="p">[</span><span class="s1">&#39;EDIF.identifier&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_def</span><span class="p">[</span><span class="s1">&#39;EDIF.identifier&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">unique_suffix</span>
    <span class="n">lib</span><span class="o">.</span><span class="n">add_definition</span><span class="p">(</span><span class="n">new_def</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">reference</span> <span class="o">=</span> <span class="n">new_def</span>

<span class="k">def</span> <span class="nf">_is_unique</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;return if the instance is the only one of its kind in the definition&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">reference</span><span class="o">.</span><span class="n">references</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">instance</span><span class="o">.</span><span class="n">reference</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">()</span>

<div class="viewcode-block" id="uniquify"><a class="viewcode-back" href="../../reference/api_specification.html#spydrnet.uniquify.uniquify">[docs]</a><span class="k">def</span> <span class="nf">uniquify</span><span class="p">(</span><span class="n">netlist</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;make the instances in the netlist unique</span>
<span class="sd">    uniqification is done in place. Each instance will correspond to exactly one definition and each definition will correspond to exactly one instance with the exception of leaf cells.</span>
<span class="sd">    Leaf cells are can be instanced unlimited numbers of times. Any netlist elements that are not instantiated by the top instance will not be modified and may retain duplicate instances</span>
<span class="sd">    Currently there is no guarantee that the original definition names will be maintained, but it is guaranteed that they will be unique within the scope of all hardware that is below the top instance.</span>

<span class="sd">    Renameing is predictable. the string: _sdn_unique_# will be added to the end of the definition names.</span>
<span class="sd">    </span>
<span class="sd">    parameter - netlist, the netlist that will be uniquified</span>

<span class="sd">    returns - no returns</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1">#import pdb; pdb.set_trace()</span>
    <span class="c1">#starting with top.</span>
    <span class="c1">#top must be unique below top. otherwise we have infinite harware recursion which is does not make much sense.    </span>
    <span class="n">instance_queue</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>

    <span class="n">top_instance</span> <span class="o">=</span> <span class="n">netlist</span><span class="o">.</span><span class="n">top_instance</span>

    <span class="n">top_definition</span> <span class="o">=</span> <span class="n">top_instance</span><span class="o">.</span><span class="n">reference</span>

    <span class="c1">#put all of tops children on a stack</span>
    <span class="k">for</span> <span class="n">chld</span> <span class="ow">in</span> <span class="n">top_definition</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
        <span class="n">instance_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chld</span><span class="p">)</span>

    <span class="c1">#for each of the children on the stack</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">instance_queue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="n">instance_queue</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
        <span class="c1">#if they are not unique</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_unique</span><span class="p">(</span><span class="n">inst</span><span class="p">):</span>
            <span class="c1">#uniquify</span>
            <span class="n">_make_instance_unique</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
        <span class="c1">#put their children on the stack</span>
        <span class="k">for</span> <span class="n">chld</span> <span class="ow">in</span> <span class="n">inst</span><span class="o">.</span><span class="n">reference</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">instance_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chld</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Brigham Young Universitiy

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>